import actionTypes from './action-types';
import mockCategories from '../mock/categories';

const categoriesLength = mockCategories.length;
let lastId = mockCategories[categoriesLength - 1].id;

export function setCategoryUpdateId(categoryId) {
  return {
    type: actionTypes.SET_CATEGORY_UPDATE_ID,
    categoryId
  };
}

export function clearCategoryUpdateId() {
  return {
    type: actionTypes.CLEAR_CATEGORY_UPDATE_ID
  };
}

export function resetCreateCategoryResolution() {
  return {
    type: actionTypes.CREATE_CATEGORY_RESET_RESOLUTION
  };
}

export function createCategory(data) {
  return dispatch => {
    dispatch({type: actionTypes.CREATE_CATEGORY});

    const newId = ++lastId;

    // Simulate fake network latency
    window.setTimeout(() => {
      const newCategory = {
        ...data,
        id: newId
      };

      dispatch({
        type: actionTypes.CREATE_CATEGORY_SUCCESS,
        category: newCategory
      });
    }, 1000);
  };
}

export function retrieveCategories() {
  return (dispatch, getState) => {
    dispatch({type: actionTypes.RETRIEVE_CATEGORIES});

    window.setTimeout(() => {
      const existingCategories = getState().categories.categories;
      let categories;
      if (!existingCategories.length) {
        categories = [...mockCategories];
      } else {
        categories = existingCategories;
      }

      dispatch({
        type: actionTypes.RETRIEVE_CATEGORIES_SUCCESS,
        categories
      });
    }, 1200);
  };
}

export function resetUpdateCategoryResolution() {
  return {
    type: actionTypes.UPDATE_CATEGORY_RESET_RESOLUTION
  };
}

export function updateCategory(category) {
  return dispatch => {
    dispatch({type: actionTypes.UPDATE_CATEGORY, category});

    window.setTimeout(() => {
      dispatch({
        type: actionTypes.UPDATE_CATEGORY_FAILURE,
        category
      });
    }, 1000);
  };
}

export function resetDeleteCategoryResolution() {
  return {
    type: actionTypes.DELETE_CATEGORY_RESET_RESOLUTION
  };
}

export function deleteCategory(categoryId) {
  return dispatch => {
    dispatch({type: actionTypes.DELETE_CATEGORY});

    window.setTimeout(() => {
      dispatch({
        type: actionTypes.DELETE_CATEGORY_SUCCESS,
        categoryId
      });
    }, 1000);
  };
}
